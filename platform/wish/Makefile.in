VPATH=          @srcdir@
BUILDTOP=       @BUILDTOP@
PREFIX=         @prefix@

PLATFORM        = @platform@
INSTALL         = @INSTALL@
INSTALL_BIN     = $(INSTALL) -s -m 555
INSTALL_DIR     = @INSTALL_DIR@
CC              = @CC@

LIBS            = @LIBS@
CPPFLAGS        = @CPPFLAGS@
CFLAGS          = @CFLAGS@
LDFLAGS         = @LDFLAGS@
LN_S            = @LN_S@

PROVIDETCLLIBS  = @PROVIDETCLLIBS@
TCLLIBTCLDIR    = @oz_tcl_lib_tcl_dir@
TKLIBTCLDIR     = @oz_tk_lib_tcl_dir@


OZWISH          = oz.wish.bin
SRCS            = ozMain.c ozAppInit.c
OBJS            = ${SRCS:.c=.o}

.PHONY: $(PROVIDETCLLIBS)

all: $(OZWISH)

bootstrap: all

$(OZWISH): $(OBJS)
        $(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

clean:
        -rm -f $(OBJS) *~

veryclean: clean
        -rm -f $(OZWISH)

distclean: veryclean
        -rm -f config.* Makefile
        -rm -f ozwish80.mk ozwish.mk1 ozwish.lk1 ozwish.imp ozwish.map ozwish.sym

install: $(PREFIX)/platform/$(PLATFORM) $(OZWISH) \
        $(PROVIDETCLLIBS) $(PREFIX)/lib/wish
        $(INSTALL_BIN) $(OZWISH) $(PREFIX)/platform/$(PLATFORM)

$(PREFIX)/platform/$(PLATFORM):
        $(INSTALL_DIR) $@

provide-link:
        rm -rf $(PREFIX)/lib/wish
        $(INSTALL_DIR) $(PREFIX)/lib/wish
        (cd $(PREFIX)/lib/wish; rm -rf tcl)
        (cd $(PREFIX)/lib/wish; $(LN_S) $(TCLLIBTCLDIR) tcl)
        (cd $(PREFIX)/lib/wish; rm -rf tk)
        (cd $(PREFIX)/lib/wish; $(LN_S) $(TKLIBTCLDIR) tk)

provide-copy:
        rm -rf $(PREFIX)/lib/wish
        $(INSTALL_DIR) $(PREFIX)/lib/wish
        (cd $(PREFIX)/lib/wish; rm -rf tcl)
        (cd $(PREFIX)/lib/wish; cp -r $(TCLLIBTCLDIR) .)
        (cd $(PREFIX)/lib/wish; $(LN_S) tcl8.0 tcl)
        (cd $(PREFIX)/lib/wish; rm -rf tk)
        (cd $(PREFIX)/lib/wish; cp -r $(TKLIBTCLDIR) .)
        (cd $(PREFIX)/lib/wish; $(LN_S) tk8.0 tk)

check:
