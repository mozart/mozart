README for Oz AM

This is the Oz machine.

REQUIREMENTS

  GNU m4 1.0.3
  GNU gcc 2.5.6  or SunPro CC
  GNU gmp
  flex > 2.5.3
  GNU Bison > 1.25
  GNU make

FILES
   Oz/
        include/
        Emulator/

-----------------------------

Debugging with Emacs:

C-c C-d
	use gdb mode

C-c m
	choose an emulator

M-x set-variable oz-gdb-autostart nil
	allows to set breakpoints before the emulator starts.
	After setting your breakpoints type 'r' to start the emulator.

C-x SPACE
	in C files sets a breakpoint at point.

-----------------------------

# Debug functions (usable from gdb)

# Imakefile: -DRECINSTRFETCH=500
p CodeArea::writeInstr()


p displayCode(PC,10,1)
p CodeArea::printDef(PC)

p am.currentThread->printTaskStack(PC,0,10)
p am.currentThread->printTaskStack((ProgramCounter) -1,0,10)
p printStack()

p board->printDebug()
p board->printLongDebug()

----------------------------

# debug bootstrap with new ozm/emu

make bootstrap OZEMULATOR=~/d-emu OZMAFILE=./ozbatch.ozm
make stage1 OZEMULATOR=~/d-emu OZMAFILE=./ozbatch.ozm
make clean
make stage2 OZEMULATOR=~/d-emu
make clean
make stage3 OZEMULATOR=~/d-emu

# debug the bootstrap procedure under GDB:

cd ~/mozart/share/lib

set env OZ_LOAD "root=.:prefix=http\://www.ps.uni-sb.de/ozhome/lib/=tyc/:prefix=http\://www.ps.uni-sb.de/ozhome/lib/=./"

r -init '' -b ozbatch.ozm -a ~/mozart/share/lib/DumpInitial.oz

r -init '' -b ozbatch.ozm -a --include=~/Oz/lib/DumpIntro.oz -c ~/Oz/lib/Init.oz

r -init './Init.ozc' -b ~/Oz/lib/ozbatch.ozm -a --include=DumpIntro.oz -c -l AP OPI.oz -o OPI.ozc

-----------------------------

# run asm test

r -d -init '' -b ~/Oz/test/asm/mini.ozm
